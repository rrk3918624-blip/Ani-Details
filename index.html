<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5807798439185253"
     crossorigin="anonymous"></script>
<meta charset="UTF-8">
<title>Ani Details</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0b1220;
  color:#fff;
}
header{
  padding:15px;
  background:#0e1627;
  position:sticky;
  top:0;
  z-index:1000;
}
header.hide{display:none;}
header h1{margin:0;color:#4cc2ff;}

.search-box input{
  width:100%;
  padding:10px;
  margin-top:10px;
  border-radius:8px;
  border:none;
}

.section{padding:15px;}
.section h2{margin-bottom:10px;}

.anime-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:12px;
}

.card{
  background:#121a2e;
  border-radius:10px;
  overflow:hidden;
  cursor:pointer;
}
.card img{
  width:100%;
  height:180px;
  object-fit:cover;
}
.card .info{padding:8px;}
.card .title{font-size:13px;font-weight:bold;}
.card .meta{font-size:11px;color:#4cc2ff;margin-top:4px;}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.95);
  display:none;
  justify-content:center;
  align-items:flex-start;
  overflow:auto;
  z-index:2000;
}
.modal-content{
  background:#121a2e;
  padding:15px;
  border-radius:10px;
  width:90%;
  max-width:420px;
  margin:30px 0;
}
.close{
  float:right;
  color:#ff4c4c;
  cursor:pointer;
}

.trailer-link{
  display:block;
  margin-top:12px;
  padding:10px;
  background:#1c2747;
  border-radius:8px;
  text-align:center;
  color:#4cc2ff;
  text-decoration:none;
}

.comments{margin-top:15px;}
.comments textarea{
  width:100%;
  height:60px;
  border-radius:6px;
  border:none;
  padding:8px;
}
.comments button{
  margin-top:6px;
  padding:8px;
  width:100%;
  border:none;
  border-radius:6px;
  background:#4cc2ff;
  font-weight:bold;
}
.comment{
  background:#0e1627;
  padding:6px;
  border-radius:6px;
  margin-top:6px;
  font-size:13px;
}
</style>
</head>

<body>

<header id="header">
<h1>Ani Details</h1>
<div class="search-box">
<input placeholder="Search anime..." onkeyup="debouncedSearch(this.value)">
</div>
</header>

<div class="section"><h2>Trending</h2><div id="trending" class="anime-grid"></div></div>
<div class="section"><h2>Upcoming</h2><div id="upcoming" class="anime-grid"></div></div>
<div class="section"><h2>Top Rated</h2><div id="top" class="anime-grid"></div></div>

<div class="section"><h2>Action</h2><div id="action" class="anime-grid"></div></div>
<div class="section"><h2>Rom-Com</h2><div id="romcom" class="anime-grid"></div></div>
<div class="section"><h2>Isekai</h2><div id="isekai" class="anime-grid"></div></div>
<div class="section"><h2>Horror</h2><div id="horror" class="anime-grid"></div></div>

<div class="modal" id="modal">
<div class="modal-content">
<span class="close" onclick="closeModal()">✖</span>

<h3 id="mTitle"></h3>
<p id="mRelease"></p>
<p id="mInfo"></p>
<p id="mRating"></p>
<p id="mDesc"></p>

<div id="trailerBox"></div>

<div class="comments">
<h4>Comments</h4>
<textarea id="commentInput" placeholder="Write comment..."></textarea>
<button onclick="addComment()">Post</button>
<div id="commentList"></div>
</div>
</div>
</div>

<script>
const API="https://graphql.anilist.co";
let timer, animeStore={}, currentAnimeId=null;

const title=a=>a.title.english||a.title.romaji;
const date=d=>d?.year?`Release: ${d.day||"??"}-${d.month||"??"}-${d.year}`:"Release: TBA";

function fetchAnime(q,v,cb){
 fetch(API,{
  method:"POST",
  headers:{'Content-Type':'application/json'},
  body:JSON.stringify({query:q,variables:v})
 }).then(r=>r.json()).then(d=>cb(d.data.Page.media));
}

function render(list,id){
 const box=document.getElementById(id);
 box.innerHTML="";
 list.forEach(a=>{
  animeStore[a.id]=a;
  box.innerHTML+=`
  <div class="card" onclick="openModal(${a.id})">
   <img src="${a.coverImage.large}">
   <div class="info">
    <div class="title">${title(a)}</div>
    <div class="meta">${a.averageScore?(a.averageScore/10).toFixed(1)+" ⭐":"N/A"}</div>
    <div class="meta">${date(a.startDate)}</div>
   </div>
  </div>`;
 });
}

function openModal(id){
 currentAnimeId=id;
 const a=animeStore[id];
 modal.style.display="flex";
 header.classList.add("hide");
 document.body.style.overflow="hidden";

 mTitle.innerText=title(a);
 mRelease.innerText=date(a.startDate);
 mInfo.innerText=`Episodes: ${a.episodes||"N/A"} | Status: ${a.status}`;
 mRating.innerText=`Rating: ${a.averageScore?(a.averageScore/10).toFixed(1)+" ⭐":"N/A"}`;
 mDesc.innerHTML=a.description||"No description";

 trailerBox.innerHTML=
 `<a class="trailer-link" target="_blank"
 href="https://www.youtube.com/results?search_query=${encodeURIComponent(title(a)+" anime trailer")}">
 ▶ Watch Trailer</a>`;

 loadComments();
}

function closeModal(){
 modal.style.display="none";
 header.classList.remove("hide");
 document.body.style.overflow="";
}

function addComment(){
 const txt=commentInput.value.trim();
 if(!txt) return;
 const key="comments_"+currentAnimeId;
 const arr=JSON.parse(localStorage.getItem(key)||"[]");
 arr.push(txt);
 localStorage.setItem(key,JSON.stringify(arr));
 commentInput.value="";
 loadComments();
}

function loadComments(){
 const key="comments_"+currentAnimeId;
 const arr=JSON.parse(localStorage.getItem(key)||"[]");
 commentList.innerHTML=arr.map(c=>`<div class="comment">${c}</div>`).join("");
}

function debouncedSearch(v){
 clearTimeout(timer);
 timer=setTimeout(()=>{if(v.length>2)search(v);},300);
}

function search(v){
 const q=`query($s:String){
  Page(perPage:20){
   media(search:$s,type:ANIME){
    id title{english romaji}
    coverImage{large}
    startDate{year month day}
    episodes status description averageScore
   }
  }
 }`;
 fetchAnime(q,{s:v},d=>render(d,"trending"));
}

/* DEFAULT */
fetchAnime(`query{Page(perPage:12){media(type:ANIME,sort:TRENDING_DESC){id title{english romaji}coverImage{large}startDate{year month day}episodes status description averageScore}}}`,{},d=>render(d,"trending"));
fetchAnime(`query{Page(perPage:12){media(type:ANIME,status:NOT_YET_RELEASED,sort:START_DATE){id title{english romaji}coverImage{large}startDate{year month day}episodes status description averageScore}}}`,{},d=>render(d,"upcoming"));
fetchAnime(`query{Page(perPage:12){media(type:ANIME,sort:SCORE_DESC){id title{english romaji}coverImage{large}startDate{year month day}episodes status description averageScore}}}`,{},d=>render(d,"top"));

/* CATEGORIES */
fetchAnime(`query{Page(perPage:12){media(type:ANIME,genre_in:["Action"],sort:POPULARITY_DESC){id title{english romaji}coverImage{large}startDate{year month day}episodes status description averageScore}}}`,{},d=>render(d,"action"));

fetchAnime(`query{Page(perPage:12){media(type:ANIME,genre_in:["Romance","Comedy"],sort:POPULARITY_DESC){id title{english romaji}coverImage{large}startDate{year month day}episodes status description averageScore}}}`,{},d=>render(d,"romcom"));

/* ✅ FIXED ISEKAI */
fetchAnime(`query{
 Page(perPage:12){
  media(type:ANIME,tag_in:["Isekai"],sort:POPULARITY_DESC){
   id title{english romaji}
   coverImage{large}
   startDate{year month day}
   episodes status description averageScore
  }
 }
}`,{},d=>render(d,"isekai"));

fetchAnime(`query{Page(perPage:12){media(type:ANIME,genre_in:["Horror"],sort:POPULARITY_DESC){id title{english romaji}coverImage{large}startDate{year month day}episodes status description averageScore}}}`,{},d=>render(d,"horror"));
</script>

</body>

</html>
